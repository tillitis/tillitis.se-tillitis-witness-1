---
- name: Ensure locales package is installed
  ansible.builtin.apt:
    name: locales
    state: present
    update_cache: yes
  become: true

- name: Enable English locale in /etc/locale.gen
  ansible.builtin.lineinfile:
    path: /etc/locale.gen
    regexp: '^#?en_US.UTF-8 UTF-8'
    line: 'en_US.UTF-8 UTF-8'
    state: present
  become: true

- name: Enable Swedish locale in /etc/locale.gen
  ansible.builtin.lineinfile:
    path: /etc/locale.gen
    regexp: '^#?sv_SE.UTF-8 UTF-8'
    line: 'sv_SE.UTF-8 UTF-8'
    state: present
  become: true

- name: Generate locales
  ansible.builtin.command: locale-gen
  become: true

- name: Set system-wide locale
  ansible.builtin.copy:
    dest: /etc/default/locale
    content: |
      LANG="en_US.UTF-8"
      LC_NUMERIC="sv_SE.UTF-8"
      LC_TIME="sv_SE.UTF-8"
      LC_MONETARY="sv_SE.UTF-8"
      LC_PAPER="sv_SE.UTF-8"
      LC_NAME="sv_SE.UTF-8"
      LC_ADDRESS="sv_SE.UTF-8"
      LC_TELEPHONE="sv_SE.UTF-8"
      LC_MEASUREMENT="sv_SE.UTF-8"
      LC_IDENTIFICATION="sv_SE.UTF-8"
    owner: root
    group: root
    mode: '0644'
  become: true

- name: Apply locale changes immediately
  ansible.builtin.command: update-locale
  become: true
